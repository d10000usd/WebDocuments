# typescript, vue 에서 함수를 호출해서 사용하는 방법
## 사용주의 사항

1. 정의 할때 js 보다는 오류에 대처하기 좋다
    - 장점이 단점 
    - 코딩 분량이 많아 짐
    - 러닝 코드가 늘어남
2. 최소 문법
   - 파라미터 에 변수 넣을 때 
     - text: string    변수 : 타입
     - number: number  변수 : 타입 
   - 변수 Null 오류
   - 
    
    ```typescript
        const matches = timeInterval.match(/([a-zA-Z]+)(\d+)/);
        // s'matches' is possibly 'null'. 요거 무시 할려면?
        const timetype = matches ? matches[1] : null;
    ```
#### Vue 3에서 ref를 사용하여 변수를 선언하면 해당 변수에 직접 접근하는 것이 아니라 
.value를 통해 접근해야 합니다. 이것은 Vue 3의 반응성 시스템과 관련이 있습니다. 
ref로 감싼 변수의 값을 가져오거나 설정할 때 .value를 사용해야 Vue가 변수의 변경을 감지하고 적절한 반응을 합니다.

1. a.vue 파일에서 typescript
```vue
<script lang="ts">
import { ref, onMounted } from 'vue'
// updateCandle 함수를 내보냅니다.

const candleData = ref(null);
const COINTICKER = ref("UPBIT:ETHKRW");


const splitText = (text: string) => text.split('-')[1]

export const mod = {
  baseUrl: 'http://172.30.1.10:5002/',
  pingEndpoint: 'ping',
  booksEndpoint: 'books',
  coinsEndpoint: 'coins',
  websocket: 'websocket',
  UpbitInfo: 'upbitinfo',
  UpdateMarkdown: 'updatemarkdown',
  chartcoin: 'chartcoin/1',
  chartstock: 'chartstock/1',
  Bokeh: 'bokeh/1',
  Report: 'report/1',

}

export function getCurrentTime() {
  const now = new Date();
  return now.toLocaleTimeString();
}

// 1초마다 현재 시간을 업데이트하는 함수
export function updateClock() {
  const timeElement = document.getElementById('clock');
  if (timeElement) {
    timeElement.textContent = getCurrentTime();
  }
}
// text: string    변수 : 타입
// number: number  변수 : 타입 
export async function fetchMarketCoinCandles(key: string, tickerg: string, candlecnt: number, timeInterval: string) {
  try {
    let url = null;

    if (timeInterval === "months" || timeInterval === "weeks" || timeInterval === "days") {
      url = `https://api.upbit.com/v1/candles/${timeInterval}/?market=KRW-${splitText(tickerg)}&count=${candlecnt}`;
    } else {
      const matches = timeInterval.match(/([a-zA-Z]+)(\d+)/);
      // s'matches' is possibly 'null'. 요거 무시 할려면?
      const timetype = matches ? matches[1] : null;
      const tset = matches ? matches[2] : null;

      url = `https://api.upbit.com/v1/candles/${timetype}/${tset}?market=KRW-${splitText(tickerg)}&count=${candlecnt}`;
    }

    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Request failed with status: ${response.status}`);
    }

    const data = await response.json();


    candleData.value = data;


    return candleData;
  } catch (error) {
    console.error(error);
  }
}
</script>
```

2. a.ts

```typescript
import { ref, onMounted } from 'vue';
// updateCandle 함수를 내보냅니다.

const candleData = ref(null);
const COINTICKER = ref("UPBIT:ETHKRW");


const splitText = (text: string) => text.split('-')[1]

export const mod = {
  baseUrl: 'http://172.30.1.10:5002/',
  pingEndpoint: 'ping',
  booksEndpoint: 'books',
  coinsEndpoint: 'coins',
  websocket: 'websocket',
  UpbitInfo: 'upbitinfo',
  UpdateMarkdown: 'updatemarkdown',
  chartcoin: 'chartcoin/1',
  chartstock: 'chartstock/1',
  Bokeh: 'bokeh/1',
  Report: 'report/1',

}

export function getCurrentTime() {
  const now = new Date();
  return now.toLocaleTimeString();
}

// 1초마다 현재 시간을 업데이트하는 함수
export function updateClock() {
  const timeElement = document.getElementById('clock');
  if (timeElement) {
    timeElement.textContent = getCurrentTime();
  }
}
// text: string    변수 : 타입
// number: number  변수 : 타입 
export async function fetchMarketCoinCandles(key: string, tickerg: string, candlecnt: number, timeInterval: string) {
  try {
    let url = null;

    if (timeInterval === "months" || timeInterval === "weeks" || timeInterval === "days") {
      url = `https://api.upbit.com/v1/candles/${timeInterval}/?market=KRW-${splitText(tickerg)}&count=${candlecnt}`;
    } else {
      const matches = timeInterval.match(/([a-zA-Z]+)(\d+)/);
      // s'matches' is possibly 'null'. 요거 무시 할려면?
      const timetype = matches ? matches[1] : null;
      const tset = matches ? matches[2] : null;

      url = `https://api.upbit.com/v1/candles/${timetype}/${tset}?market=KRW-${splitText(tickerg)}&count=${candlecnt}`;
    }

    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Request failed with status: ${response.status}`);
    }

    const data = await response.json();


    candleData.value = data;


    return candleData;
  } catch (error) {
    console.error(error);
  }
}

```















const tickers =  mod.getTickersUDF()
const websocketReceivedData = ref({});
const handleWebSocketMessage = async (payload) => {
  const data = await new Response(payload.data).json();
  // Update the reactive variable with real-time data
  websocketReceivedData.value = data;
  console.log(websocketReceivedData.value.code)
};

const setupWebSocket = () => {
  try {
    const ws = new WebSocket('wss://api.upbit.com/websocket/v1');
    ws.onopen = (e) => {
      ws.send(
        JSON.stringify([
          { ticket: "test" },
          { type: 'ticker', codes: tickers },
        ])
      );
    };
    ws.onmessage = handleWebSocketMessage;
  } catch (err) {}
};
onMounted(setupWebSocket);