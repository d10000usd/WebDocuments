<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lightweight Chart Example</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
  <div id="chart" style="width: 1000px; height: 400px;"></div>

  <script>
    class DataFetcher {
      constructor() {
        this.options = {
          "width": 1000,
          "height": 400,
          "timeScale": {
            "timeVisible": true,
            "secondsVisible": false
          },
          "priceScale": {
            "priceLineVisible": false
          },
          "movingAverages": {
            "ma5": {
              "color": "rgba(255, 0, 0, 1)",
              "lineWidth": 2,
              'priceLineVisible': false,
            },
            "ma10": {
              "color": "rgba(0, 0, 255, 1)",
              "lineWidth": 12,
              'priceLineVisible': false,
            }
          }
        };
        this.data =[
          {
              "time": 1641254400,
              "open": 18800.0,
              "high": 19300.0,
              "low": 18800.0,
              "close": 19000.0
          },
          {
              "time": 1641340800,
              "open": 19050.0,
              "high": 19100.0,
              "low": 17700.0,
              "close": 17850.0
          },
          {
              "time": 1641427200,
              "open": 17550.0,
              "high": 17750.0,
              "low": 16500.0,
              "close": 16600.0
          },
          {
              "time": 1641513600,
              "open": 16900.0,
              "high": 17150.0,
              "low": 16850.0,
              "close": 16950.0
          }
        ];
      }
    }

    // lightweight-charts를 초기화하고 데이터를 추가하는 코드
    const dataFetcher = new DataFetcher();

    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
      width: dataFetcher.options.width,
      height: dataFetcher.options.height,
      timeScale: dataFetcher.options.timeScale,
      priceScale: dataFetcher.options.priceScale,
    });

    // 데이터 포맷 변경
    const chartData = dataFetcher.data.map((item) => ({
      time: item.time * 1000, // Unix 시간을 밀리초로 변환
      open: item.open,
      high: item.high,
      low: item.low,
      close: item.close,
    }));

    // 차트에 데이터를 추가
    const candleSeries = chart.addCandlestickSeries();
    candleSeries.setData(chartData);

    // 이동 평균 추가
    const ma5 = chart.addLineSeries({
      color: dataFetcher.options.movingAverages.ma5.color,
      lineWidth: dataFetcher.options.movingAverages.ma5.lineWidth,
    });
    const ma10 = chart.addLineSeries({
      color: dataFetcher.options.movingAverages.ma10.color,
      lineWidth: dataFetcher.options.movingAverages.ma10.lineWidth,
    });

    // 이동 평균 데이터 추가
    const ma5Data = dataFetcher.data.map((item) => ({
      time: item.time * 1000,
      value: item.close, // 닫는 가격을 기준으로 이동 평균 계산
    }));
    const ma10Data = dataFetcher.data.map((item) => ({
      time: item.time * 1000,
      value: item.close,
    }));

    ma5.setData(ma5Data);
    ma10.setData(ma10Data);
  </script>
</body>
</html>
